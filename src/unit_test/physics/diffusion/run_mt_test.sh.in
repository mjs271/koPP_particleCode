#!/bin/bash

# OpenMP environment variables
if [ "$IN_CONTAINER" = true ]; then
    export OMP_NUM_THREADS=$(nproc)
else
    export OMP_NUM_THREADS=12
fi
export OMP_PROC_BIND=spread
export OMP_PLACES=threads

export KK_TOOLS_DIR=${HOME}/kokkos-tools
export MACHINE=`hostname`

# simple kernel timer location
# export KOKKOS_PROFILE_LIBRARY=${KK_TOOLS_DIR}/kp_kernel_timer.so
# export PATH=${PATH}:${KK_TOOLS_DIR}

export THIS_DIR=@CMAKE_CURRENT_BINARY_DIR@
export INSTALL_DIR=@CMAKE_BINARY_DIR@

export dim=(1 2 3)
export N=(1000 1000 1000)
export L=(10 5 5)
export dist=(1.1345 1.3 1.6)
export pt_type=("rand" "rand" "rand")
# kernel logger
export KOKKOS_PROFILE_LIBRARY=${HOME}/kokkos-tools/kp_kernel_logger.so
export PATH=${PATH}:${HOME}/kokkos-tools/

export PT_EXE=${INSTALL_DIR}/bin/parPT
export YAML_IN=${THIS_DIR}/data/mt_test_1d.yaml

# write the points to the bottom of the yaml input
${THIS_DIR}/utils/gen_pts.py3 --fname=${YAML_IN}

# run the program and redirect the error output
$PT_EXE $YAML_IN -v > a.out 2> a.err

${THIS_DIR}/utils/verify_mt.py3 ${THIS_DIR}/data/particles.txt

# for ((i=0; i<=2; i++))
# do
#     echo "==========================================="

#     echo "num_threads = ${OMP_NUM_THREADS}"
#     echo "dim =  ${dim[i]}"
#     echo "N =  ${N[i]}"
#     echo "L =  ${L[i]}"
#     echo "dist =  ${dist[i]}"
#     echo "pt_type =  ${pt_type[i]}"
#     echo "infile =  ${infile}"

#     echo "==========================================="

#     ${THIS_DIR}/gen_pts.py3 ${dim[i]} ${N[i]} ${L[i]} ${dist[i]} ${pt_type[i]} --fname=${infile}
#     ${THIS_DIR}/MT_test ${infile}
# done

# # used when timing
# kp_reader *.dat > time_data.txt
# # mike's laptop
# rm ${MACHINE}*.dat

